<არაფერს ეძებს>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <title>Excel მონაცემების ძიება</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        input { padding: 8px; width: 300px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        th { background-color: #f4f4f4; }
        img { max-width: 100px; max-height: 100px; }
        #unique-selector { margin-top: 10px; }
    </style>
</head>
<body>

<h2>მონაცემების ძიება Excel-იდან</h2>
<input type="text" id="search" placeholder="მოძებნე სახელი, გვარი, ციფრი..." />
<div id="unique-selector"></div>
<table id="data-table"></table>

<script src="xlsx.full.min.js"></script>
<script>
    let data = [];

    async function loadExcel() {
        const response = await fetch('data.xlsx');
        const arrayBuffer = await response.arrayBuffer();
        const workbook = XLSX.read(arrayBuffer, { type: "array" });

        // ყველა sheet-დან მონაცემების წაკითხვა
        data = [];
        workbook.SheetNames.forEach(sheetName => {
            const sheet = workbook.Sheets[sheetName];
            const sheetData = XLSX.utils.sheet_to_json(sheet);
            data = data.concat(sheetData);
        });

        displayTable(data);
    }

    function displayTable(filteredData) {
        const table = document.getElementById('data-table');
        table.innerHTML = '';

        if (filteredData.length === 0) {
            table.innerHTML = '<tr><td colspan="100%">შედეგი არ მოიძებნა</td></tr>';
            return;
        }

        const headers = Object.keys(filteredData[0]);
        const thead = document.createElement('tr');
        headers.forEach(h => {
            const th = document.createElement('th');
            th.textContent = h;
            thead.appendChild(th);
        });
        table.appendChild(thead);

        filteredData.forEach(row => {
            const tr = document.createElement('tr');
            headers.forEach(h => {
                const td = document.createElement('td');
                const val = row[h];
                if (val && typeof val === 'string' && (val.toLowerCase().endsWith('.jpg') || val.toLowerCase().endsWith('.png'))) {
                    const img = document.createElement('img');
                    img.src = val;
                    td.appendChild(img);
                } else {
                    td.textContent = val !== undefined && val !== null && val !== "nan" ? val : '';
                }
                tr.appendChild(td);
            });
            table.appendChild(tr);
        });
    }

    document.getElementById('search').addEventListener('input', function () {
        const query = this.value.toLowerCase();
        const matches = data.filter(row =>
            Object.values(row).some(val =>
                val && val.toString().toLowerCase().includes(query)
            )
        );

        const selectorDiv = document.getElementById('unique-selector');
        selectorDiv.innerHTML = '';

        const lastNames = matches.map(row => row["გვარი"]).filter(Boolean);
        const uniqueLastNames = [...new Set(lastNames)];

        if (uniqueLastNames.length > 1) {
            const label = document.createElement('label');
            label.textContent = "აირჩიე გვარი: ";
            const select = document.createElement('select');
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'ყველა';
            select.appendChild(defaultOption);

            uniqueLastNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                select.appendChild(option);
            });

            select.addEventListener('change', () => {
                const selected = select.value;
                const filtered = selected ? matches.filter(row => row["გვარი"] === selected) : matches;
                displayTable(filtered);
            });

            selectorDiv.appendChild(label);
            selectorDiv.appendChild(select);
        }

        displayTable(matches);
    });

    loadExcel();
</script>

</body>
</html>
